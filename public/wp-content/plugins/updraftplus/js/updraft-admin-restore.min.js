var updraft_restore_screen=!0;jQuery(document).ready(function(e){function r(r,a){var o=new XMLHttpRequest,n="action="+a+"&updraftplus_ajax_restore=do_ajax_restore&job_id="+r,d=0,l=!0,u=e("#updraftplus_ajax_restore_debug").length;o.open("POST",ajaxurl,!0),o.onprogress=function(e){if(e.currentTarget.status>=200&&e.currentTarget.status<300){if(-1!==e.currentTarget.responseText.indexOf("<html"))return l&&(l=!1,alert("UpdraftPlus "+updraftlion.ajax_restore_error+" "+updraftlion.ajax_restore_invalid_response)),c.append("UpdraftPlus "+updraftlion.ajax_restore_error+" "+updraftlion.ajax_restore_invalid_response),console.log("UpdraftPlus restore error: HTML detected in response could be a copy of the WordPress front page caused by mod_security"),void console.log(e.currentTarget.responseText);if(d==e.currentTarget.responseText.length)return;i=Math.round(Date.now()/1e3);var r=e.currentTarget.responseText.substr(d);d=e.currentTarget.responseText.length;for(var a=0,o=0;a<r.length;){var n=r.substr(a,7);if("RINFO:{"==n){c.append(r.substring(o,a).trim()).scrollTop(c[0].scrollHeight);var p=ud_parse_json(r.substr(a),!0);1==u&&console.log(p),t(p.parsed),o=a+p.json_last_pos-p.json_start_pos+6,a=o}else a++}c.append(r.substr(o).trim()).scrollTop(c[0].scrollHeight),c.find("input[name=connection_type]").length&&c.find("#upgrade").length&&s()}else 0==e.currentTarget.status?c.append("UpdraftPlus "+updraftlion.ajax_restore_error+" "+updraftlion.ajax_restore_contact_failed):c.append("UpdraftPlus "+updraftlion.ajax_restore_error+" "+e.currentTarget.status+" "+e.currentTarget.statusText),console.log("UpdraftPlus restore error: "+e.currentTarget.status+" "+e.currentTarget.statusText),console.log(e.currentTarget)},o.onload=function(){var r=c.find(".updraft_restore_successful, .updraft_restore_error");if(r.length){var t=e(".updraft_restore_result");t.slideDown(),_.slideUp(),_.siblings("h2").slideUp(),r.is(".updraft_restore_successful")?(t.find(".dashicons").addClass("dashicons-yes"),t.find(".updraft_restore_result--text").text(r.text()),t.addClass("restore-success")):r.is(".updraft_restore_error")&&(t.find(".dashicons").addClass("dashicons-no-alt"),t.find(".updraft_restore_result--text").text(r.text()),t.addClass("restore-error")),setTimeout(function(){c.scrollTop(c[0].scrollHeight)},500)}},o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(n)}function t(r){if("started"==r.stage&&(n=setInterval(function(){a()},5e3)),"finished"==r.stage&&n&&(clearInterval(n),e("#updraftplus_ajax_restore_last_activity").html("")),r&&("state"==r.type||"state_change"==r.type)){console.log(r.stage,r.data),l="files"==r.stage?r.data.entity:r.stage;var t=_.find("[data-component="+l+"]");if("files"==r.stage&&t.find(".updraft_component--progress").html(" — "+updraftlion.restore_files_progress.replace("%s1","<strong>"+r.data.fileindex+"</strong>").replace("%s2","<strong>"+r.data.total_files+"</strong>")),"db"==r.stage&&r.data.hasOwnProperty("stage")&&("table"==r.data.stage?t.find(".updraft_component--progress").html(" — "+updraftlion.restore_db_table_progress.replace("%s","<strong>"+r.data.table+"</strong>")):"finished"==r.data.stage?t.find(".updraft_component--progress").html(" — "+updraftlion.finished):"begun"==r.data.stage&&t.find(".updraft_component--progress").html(" — "+updraftlion.begun+"...")),d!==l){if(d){var s=_.find("[data-component="+d+"]");s.find(".updraft_component--progress").html(""),s.removeClass("active").addClass("done")}"finished"==l?(t.addClass("done"),_.find("[data-component]").each(function(r,t){$el=e(t),$el.is(".done")||$el.addClass("error")}),r.data.hasOwnProperty("actions")&&"object"==typeof r.data.actions&&e.each(r.data.actions,function(e,r){_.after('<a href="'+r+'" class="button button-primary">'+e+"</a>")})):t.addClass("active")}d=l}}function a(){var r=Math.round(Date.now()/1e3),t=r-i;if(60>t)e("#updraftplus_ajax_restore_last_activity").html(updraftlion.last_activity.replace("%d",t));else{var a=120-t;0<a?e("#updraftplus_ajax_restore_last_activity").html(updraftlion.no_recent_activity.replace("%d",a)):(e("#updraftplus_ajax_restore_last_activity").html(""),o())}}function s(){e(".updraft_restore_main").addClass("show-credentials-form"),e("#message").length&&(e(".restore-credential-errors .restore-credential-errors--list").appendTo(e("#message")),e(".restore-credential-errors .restore-credential-errors--link").appendTo(e("#message")))}function o(){updraft_send_command("get_restore_resume_notice",{job_id:u},function(r){r.hasOwnProperty("status")&&"success"==r.status&&r.hasOwnProperty("html")?(n&&clearInterval(n),e(".updraft_restore_main--components").prepend(r.html)):r.hasOwnProperty("error_code")&&r.hasOwnProperty("error_message")&&(n&&clearInterval(n),alert(r.error_code+": "+r.error_message),console.log(r.error_code+": "+r.error_message))},{error_callback:function(e,r,t,a){var s="updraft_send_command: error: "+r+" ("+t+")";console.log(s),console.log(e)}})}var n,d,l,u=e("#updraftplus_ajax_restore_job_id").val(),p=e("#updraftplus_ajax_restore_action").val(),i=0,c=e("#updraftplus_ajax_restore_output"),_=e(".updraft_restore_components_list"),f=!1;r(u,p),e("#updraftplus_ajax_restore_progress").on("click","#updraft_restore_resume",function(t){t.preventDefault(),e("#updraftplus_ajax_restore_progress").slideUp(1e3,function(){e(this).remove()}),r(u,"updraft_ajaxrestore_continue")}),e(document).on("heartbeat-tick",function(e,r){if(r.hasOwnProperty("wp-auth-check")){if(!r["wp-auth-check"])return void(f=!0);if(f&&r["wp-auth-check"]&&(i=Math.round(Date.now()/1e3),f=!1),r.hasOwnProperty("updraftplus")){var t=r.updraftplus;t.hasOwnProperty("updraft_credentialtest_nonce")&&(updraft_credentialtest_nonce=t.updraft_credentialtest_nonce,i=Math.round(Date.now()/1e3))}}})});