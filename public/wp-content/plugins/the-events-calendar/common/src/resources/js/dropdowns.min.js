var tribe_dropdowns=window.tribe_dropdowns||{};!function(e,t,r){"use strict";t.selector={dropdown:".tribe-dropdown",created:".tribe-dropdown-created",searchField:".select2-search__field"},e.fn.tribe_dropdowns=function(){return t.dropdown(this,{}),this},t.freefrom_create_search_choice=function(t){var a=e.trim(t.term);if(""===a)return null;var o=this.options.options,s=o.$select;if(a.match(o.regexToken)&&(!s.is("[data-int]")||s.is("[data-int]")&&a.match(/\d+/))){var i={id:a,text:a,new:!0};return s.is("[data-create-choice-template]")&&(i.text=r.template(s.data("createChoiceTemplate"))({term:a})),i}return null},t.search_id=function(e){var t=void 0;return void 0!==e.id?t=e.id:void 0!==e.ID?t=e.ID:void 0!==e.value&&(t=e.value),void 0===e?void 0:t},t.matcher=function(a,o){if(""===e.trim(a.term))return o;if(void 0===o.text)return null;var s=e.trim(a.term),i=o.text,n=e(o.element).closest("select").data("dropdown"),d=-1!==i.toUpperCase().indexOf(s.toUpperCase());if(!d&&void 0!==n.tags){var c=r.where(n.tags,{text:i});if(n.tags.length>0&&r.isObject(c))d=-1!==t.search_id(c[0]).toUpperCase().indexOf(s.toUpperCase())}return d},t.init_selection=function(t,r){var a=t.is("[multiple]"),o=t.data("dropdown"),s=(t.data("isEmpty"),t.val().split(o.regexSplit)),i=[];if(e(s).each(function(r,a){var s=function t(r,a){if(!e.isArray(a))return!1;for(var o in a){var s=a[o];if(s.hasOwnProperty("id")&&s.id==r.id)return s;if(s.hasOwnProperty("text")&&s.text==r.text)return s;if(s.hasOwnProperty("children")&&e.isArray(s.children)){var i=t(r,s.children);if(i)return i}}return!1}({id:this,text:this},o.ajax?t.data("options"):o.data);s&&s.selected&&i.push(s)}),i.length&&a)r(i);else{if(!i.length)return void r(!1);r(i[0])}},t.getSelectClasses=function(e){var t=e.attr("class").split(/\s+/);return r.difference(t,["select2-hidden-accessible","hide-before-select2-init"])},t.element=function(a,o){var s,i=e(a);o=e.extend({},o);if(i.addClass(t.selector.created.className()),o.$select=i,o.dropdownAutoWidth=!0,o.width="resolve",o.containerCss={},i.is(":visible")&&(o.containerCss.display="inline-block",o.containerCss.position="relative"),o.dropdownCss={},o.dropdownCss.width="auto",i.is("[data-dropdown-css-width]")&&(o.dropdownCss.width=i.data("dropdown-css-width"),o.dropdownCss.width&&"false"!==o.dropdownCss.width||(delete o.dropdownCss.width,delete o.containerCss)),o.allowClear=!0,i.is("[data-prevent-clear]")&&(o.allowClear=!1),i.is("[data-searching-placeholder]")&&(o.formatSearching=i.data("searching-placeholder")),!i.is("[data-placeholder]")&&i.is("[placeholder]")&&(o.placeholder=i.attr("placeholder")),i.is("[data-options]")&&(o.data=i.data("options")),o.minimumResultsForSearch=10,i.is("[data-hide-search]")&&(o.minimumResultsForSearch=1/0),i.is("[data-force-search]")&&delete o.minimumResultsForSearch,i.is("[data-freeform]")&&(o.createTag=t.freefrom_create_search_choice,o.tags=!0,i.data("tags",!0)),i.is("[multiple]")&&(o.multiple=!0,i.is("[data-maximum-selection-size]")&&(o.maximumSelectionSize=i.data("maximum-selection-size")),i.is("data-separator")||i.data("separator",","),r.isArray(i.data("separator"))?o.tokenSeparators=i.data("separator"):o.tokenSeparators=[i.data("separator")],o.separator=i.data("separator"),o.regexSeparatorElements=["^("],o.regexSplitElements=["(?:"],e.each(o.tokenSeparators,function(e,t){o.regexSeparatorElements.push("[^"+t+"]+"),o.regexSplitElements.push("["+t+"]")}),o.regexSeparatorElements.push(")$"),o.regexSplitElements.push(")"),o.regexSeparatorString=o.regexSeparatorElements.join(""),o.regexSplitString=o.regexSplitElements.join(""),o.regexToken=new RegExp(o.regexSeparatorString,"ig"),o.regexSplit=new RegExp(o.regexSplitString,"ig")),i.is("[data-tags]")&&(o.tags=i.data("tags"),o.createSearchChoice=function(e,t){if(e.match(o.regexToken))return{id:e,text:e}},0===o.tags.length&&(o.formatNoMatches=function(){return i.attr("placeholder")})),i.is("[data-source]")){var n=i.data("source");o.data={results:[]},o.formatResult=function(t,r,a){return void 0!==t.breadcrumbs?e.merge(t.breadcrumbs,[t.text]).join(" &#187; "):t.text},o.ajax={dataType:"json",type:"POST",url:t.ajaxurl(),processResults:function(t,r,a){return e.isPlainObject(t)&&void 0!==t.success?e.isPlainObject(t.data)&&void 0!==t.data.results?t.success?t.data:("string"===e.type(t.data.message)?console.error(t.data.message):console.error("The Select2 search failed in some way... Verify the source."),{results:[]}):(console.error("We received a malformed results array, could not complete the Select2 Search."),{results:[]}):(console.error("We received a malformed Object, could not complete the Select2 Search."),{results:[]})}},o.ajax.data=function(e,t){return{action:"tribe_dropdown",source:n,search:e,page:t,args:i.data("source-args")}}}i.is("[data-attach-container]")&&(e.fn.select2.amd.define("CustomDropdownAdapter",["select2/utils","select2/dropdown","select2/dropdown/attachContainer"],function(e,t,r){return e.Decorate(t,r)}),o.dropdownAdapter=e.fn.select2.amd.require("CustomDropdownAdapter")),i.data("dropdown",o),(s=i.select2(o)).data("select2").$container.addClass(t.getSelectClasses(i).join(" ")),s.data("select2").$container.removeClass("hide-before-select2-init"),s.on("select2:open",t.action_select2_open)},t.ajaxurl=function(){return void 0!==window.ajaxurl?window.ajaxurl:"undefined"!=typeof TEC&&void 0!==TEC.ajaxurl?TEC.ajaxurl:void console.error("Dropdowns framework cannot properly do an AJAX request without the WordPress `ajaxurl` variable setup.")},t.action_select2_open=function(r){var a=e(this),o=(a.data("dropdown"),a.data("select2")),s=o.$dropdown.find(t.selector.searchField);o.$dropdown.addClass(t.selector.dropdown.className()),a.is("[data-search-placeholder]")&&s.attr("placeholder",a.data("searchPlaceholder"))},t.dropdown=function(e,r){var a=e.not(".select2-offscreen, .select2-container, "+t.selector.created.className());return 0===a.length?a:(r||(r={}),a.each(function(e,a){t.element(a,r)}),a)},e(function(){e(t.selector.dropdown).tribe_dropdowns()}),e(window).on("unload",function(){e(t.selector.dropdown).tribe_dropdowns()})}(jQuery,tribe_dropdowns,window.underscore||window._);